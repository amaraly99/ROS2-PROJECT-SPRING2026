%YAML 1.0
---

#--------------------------------------------------------------------------------------------
# Camera Parameters.
#--------------------------------------------------------------------------------------------

Camera.topic_left: /cam0/image_raw
Camera.topic_right: /cam1/image_raw

Camera.model_left: pinhole
Camera.model_right: pinhole

Camera.left_nwidth: 752
Camera.left_nheight: 480

Camera.right_nwidth: 752
Camera.right_nheight: 480

# Camera calibration (EuRoC Standard)
Camera.fxl: 458.654
Camera.fyl: 457.296
Camera.cxl: 367.215
Camera.cyl: 248.375

Camera.k1l: -0.28340811
Camera.k2l: 0.07395907
Camera.p1l: 0.00019359
Camera.p2l: 1.76187114e-05

Camera.fxr: 457.587
Camera.fyr: 456.134
Camera.cxr: 379.999
Camera.cyr: 255.238

Camera.k1r: -0.28368365
Camera.k2r: 0.07451284
Camera.p1r: -0.00010473
Camera.p2r: -3.555907e-05

# Camera Extrinsic parameters
body_T_cam0: !!opencv-matrix
   rows: 4
   cols: 4
   dt: d
   data: [0.0148655429818, -0.999880929698, 0.00414029679422, -0.0216401454975,
           0.999557249008, 0.0149672133247, 0.025715529948,  -0.064676986768,
           -0.0257744366974, 0.00375618835797, 0.999660727178, 0.00981073058949,
           0., 0., 0., 1.]

body_T_cam1: !!opencv-matrix
   rows: 4
   cols: 4
   dt: d
   data: [0.0125552670891, -0.999755099723, 0.0182237714554, -0.0198435579556,
           0.999598781151, 0.0130119051815, 0.0251588363115, 0.0453689425024,
          -0.0253898008918, 0.0179005838253, 0.999517347078, 0.00786212447038,
          0., 0., 0., 1.]

#--------------------------------------------------------------------------------------------
# SLAM Parameters. (TUNED FOR 0.07m ACCURACY)
#--------------------------------------------------------------------------------------------
debug: 0
log_timings: 0

mono: 0
stereo: 1

# CRITICAL: Disable realtime skipping. We want ACCURACY.
# We will play the bag slowly (-r 0.2), so this ensures no drops.
force_realtime: 1

# Estimator Mode
slam_mode: 1
buse_loop_closer: 1
bdo_stereo_rect: 0
alpha: 0.
bdo_undist: 0
finit_parallax: 20.

# Features Extractor
use_shi_tomasi: 0
use_fast: 0
use_brief: 1
use_singlescale_detector: 1

# CRITICAL: Min dist between kps. 
# 35 = ~300 features (Too Low).
# 15 = ~1000 features (Paper Quality).
nmaxdist: 25

# Features quality th.
# Lower threshold to see in the dark (MH_05 has dark scenes)
nfast_th: 10
dmaxquality: 0.0001

# Pre-processing
use_clahe: 1
fclahe_val: 3

# KLT related settings.
do_klt: 1
klt_use_prior: 1
btrack_keyframetoframe: 0
nklt_win_size: 9
nklt_pyr_lvl: 3

# Optimization
nmax_iter: 30
fmax_px_precision: 0.01
fmax_fbklt_dist: 0.5
nklt_err: 30.

# Matching th.
bdo_track_localmap: 1
fmax_desc_dist: 0.2
fmax_proj_pxdist: 2.

# RANSAC
doepipolar: 1
dop3p : 0
bdo_random: 1
nransac_iter: 100
fransac_err: 3.

fmax_reproj_err: 3.
buse_inv_depth: 1

# Ceres related parameters
robust_mono_th: 5.9915
use_sparse_schur: 1
use_dogleg: 0
use_subspace_dogleg: 0
use_nonmonotic_step: 0

# Estimator parameters
apply_l2_after_robust: 1
nmin_covscore: 25
fkf_filtering_ratio: 0.95

# CRITICAL: THE MAGIC SWITCH
# This runs Global Bundle Adjustment after the bag ends.
# This is how you get from 0.17m to 0.07m.
do_full_ba: 1

#--------------------------------------------------------------------------------------------
# IMU Parameters
#--------------------------------------------------------------------------------------------
Imu.topic: /imu0
Imu.rate: 200
Imu.noise_acc: 2.0000e-3
Imu.noise_gyr: 1.6968e-04
Imu.noise_acc_rw: 3.0000e-3
Imu.noise_gyr_rw: 1.9393e-05

body_T_imu: !!opencv-matrix
   rows: 4
   cols: 4
   dt: d
   data: [1., 0., 0., 0.,
          0., 1., 0., 0.,
          0., 0., 1., 0.,
          0., 0., 0., 1.]